steps:
  - name: 'node'
    entrypoint: 'npm'
    args: ['install']

  - name: 'node'
    entrypoint: 'npm'
    args: ['run', 'generate']

  - name: 'node'
    entrypoint: 'npm'
    args: ['run', 'build']

  - name: "gcr.io/cloud-builders/gcloud-slim"
    args: [
      "storage",
      "cp",
      "--recursive",
      "dist",
      'gs://bgdk-build-for-deploy'
    ]

    # Deploy to App Engine
  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
    entrypoint: 'gcloud'
    args: ['app', 'deploy', 'api.yaml']

serviceAccount: aklapper@games-424800.iam.gserviceaccount.com

logsBucket: 'gs://logs-cloudbuild'
options:
  logging: LEGACY

# artifacts:
#   objects:
#     location: 'gs://bgdk-build-for-deploy'
#     paths: ['!**/*', "!node_modules/**/*" ]

# Optional: Define a timeout for the build
timeout: '1600s'

